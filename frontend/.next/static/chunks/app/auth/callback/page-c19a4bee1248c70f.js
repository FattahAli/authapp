(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[453],{5262:function(e,t,o){Promise.resolve().then(o.bind(o,9838))},9376:function(e,t,o){"use strict";var r=o(5475);o.o(r,"useParams")&&o.d(t,{useParams:function(){return r.useParams}}),o.o(r,"useRouter")&&o.d(t,{useRouter:function(){return r.useRouter}})},9838:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return c}});var r=o(7437),s=o(2265),a=o(9376),n=o(5526),i=o(6602),l=o(6481),u=o(9064);function c(){let e=(0,a.useRouter)(),{oauthLogin:t}=(0,i.t)(),[o,c]=(0,s.useState)(!0),[d,g]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let o=!0;return(async()=>{try{var r,s,a,i,h;c(!0),console.log("Processing OAuth callback...");let{session:f}=await (0,n.xS)();if(console.log("Supabase session:",f),console.log("Session user:",null==f?void 0:f.user),console.log("Session access token:",(null==f?void 0:null===(r=f.access_token)||void 0===r?void 0:r.substring(0,50))+"..."),!o)return;if(null==f?void 0:f.user){let r={id:f.user.id,email:f.user.email,name:(null===(s=f.user.user_metadata)||void 0===s?void 0:s.full_name)||f.user.email,picture:null===(a=f.user.user_metadata)||void 0===a?void 0:a.avatar_url};console.log("Extracted user data:",r);let n=f.access_token;console.log("Access token length:",null==n?void 0:n.length);try{let s=await t(l.O.GOOGLE,n,{name:r.name,email:r.email,picture:r.picture});if(!o)return;console.log("OAuth login successful"),console.log("Response:",s),console.log("Response isNewUser:",s.isNewUser),console.log("Response user:",s.user),d||(console.log("Showing success toast"),u.ZP.success("Google login successful!"),g(!0),console.log("Success toast shown"));let a=s.isNewUser;console.log("Is new user:",a),setTimeout(()=>{if(!o)return;let t=a?"/profile":"/users";console.log("Starting navigation to ".concat(t));try{e.push(t),console.log("Router navigation successful")}catch(e){console.error("Router error:",e);try{window.location.href=t,console.log("Window location navigation successful")}catch(e){console.error("Location error:",e),window.history.pushState({},"",t),window.location.reload()}}},500)}catch(t){if(!o)return;if(console.error("OAuth login error:",t),!d){if((null===(i=t.response)||void 0===i?void 0:i.status)===409){let e=null===(h=t.response)||void 0===h?void 0:h.data;if(null==e?void 0:e.requiresPassword)u.ZP.error("Email already registered. Please use your password to sign in.");else if(null==e?void 0:e.existingProvider){let t=e.message||"Email already associated with another account";u.ZP.error(t)}else{let t=(null==e?void 0:e.message)||"Email already associated with another account";u.ZP.error(t)}}else u.ZP.error("OAuth login failed");g(!0)}setTimeout(()=>{if(o)try{e.push("/login")}catch(e){console.error("Navigation error:",e),window.location.href="/login"}},1e3)}}else{if(!o)return;console.error("No session or user found"),d||(u.ZP.error("Authentication failed"),g(!0)),setTimeout(()=>{if(o)try{e.push("/login")}catch(e){console.error("Navigation error:",e),window.location.href="/login"}},1e3)}}catch(t){if(!o)return;console.error("OAuth callback error:",t),d||(u.ZP.error("Authentication failed"),g(!0)),setTimeout(()=>{if(o)try{e.push("/login")}catch(e){console.error("Navigation error:",e),window.location.href="/login"}},1e3)}finally{o&&c(!1)}})(),()=>{o=!1}},[e,t,d]),(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-slate-900",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-white text-lg",children:o?"Processing authentication...":"Redirecting..."})]})})}},1837:function(e,t,o){"use strict";o.d(t,{g8:function(){return a},iJ:function(){return s}});let r=o(3464).Z.create({baseURL:"http://localhost:5000/api",withCredentials:!0,headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>e,e=>Promise.reject(e)),r.interceptors.response.use(e=>e,e=>Promise.reject(e));let s={signup:async e=>(await r.post("/auth/signup",e,{headers:{"Content-Type":"multipart/form-data"}})).data,login:async e=>(await r.post("/auth/login",e)).data,oauthLogin:async e=>(await r.post("/auth/oauth/login",e)).data,resetPassword:async e=>(await r.post("/auth/reset-password",e)).data,logout:async()=>(await r.post("/auth/logout")).data,getMe:async()=>(await r.get("/auth/me")).data},a={getAllUsers:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return(await r.get("/users?page=".concat(e,"&limit=").concat(t))).data},getUserById:async e=>(await r.get("/users/".concat(e))).data,updateProfile:async e=>(await r.put("/users/profile",e,{headers:{"Content-Type":"multipart/form-data"}})).data,deleteUser:async e=>(await r.delete("/users/".concat(e))).data}},5526:function(e,t,o){"use strict";o.d(t,{qj:function(){return n},xS:function(){return i}});var r=o(6580),s=o(257);let a=(0,r.eI)("https://apnzuylximlxhtjqiwid.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFwbnp1eWx4aW1seGh0anFpd2lkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwMDQ5MTQsImV4cCI6MjA2OTU4MDkxNH0.r-RAngC6orsWbkmI8gsbhqVPO7CI6c_NaLEEl_O76I0");async function n(){try{let e=s.env.NEXT_PUBLIC_SITE_URL?"".concat(s.env.NEXT_PUBLIC_SITE_URL,"/auth/callback"):"".concat(window.location.origin,"/auth/callback");console.log("Google OAuth redirect URL:",e);let{data:t,error:o}=await a.auth.signInWithOAuth({provider:"google",options:{redirectTo:e}});if(o)throw o;return t}catch(e){throw console.error("Error signing in with Google:",e),e}}async function i(){try{let{data:e,error:t}=await a.auth.getSession();if(t)throw console.error("Supabase session error:",t),t;if(!e.session){let{data:e,error:t}=await a.auth.getUser();if(t)throw console.error("Supabase user error:",t),t;if(e.user)return{session:{user:e.user,access_token:e.user.id,refresh_token:"",expires_in:3600,token_type:"bearer",user_metadata:e.user.user_metadata||{}}}}return e}catch(e){throw console.error("Error handling OAuth callback:",e),e}}},6602:function(e,t,o){"use strict";o.d(t,{t:function(){return a}});var r=o(9625),s=o(1837);let a=(0,r.Ue)((e,t)=>({user:null,isLoading:!0,isAuthenticated:!1,login:async(t,o)=>{e({isLoading:!0});try{let r=await s.iJ.login({email:t,password:o});r.user&&(e({user:r.user,isAuthenticated:!0}),localStorage.setItem("auth",JSON.stringify({user:r.user,isAuthenticated:!0})))}catch(e){throw e}finally{e({isLoading:!1})}},oauthLogin:async(t,o,r)=>{e({isLoading:!0});try{console.log("Auth store: Starting OAuth login for provider:",t),console.log("Auth store: Access token length:",null==o?void 0:o.length),console.log("Auth store: User data:",r);let a=await s.iJ.oauthLogin({provider:t,accessToken:o,userData:r});return(console.log("Auth store: API response:",a),a.user)?(console.log("Auth store: Setting user and authentication state"),console.log("Auth store: User data to set:",a.user),e({user:a.user,isAuthenticated:!0}),localStorage.setItem("auth",JSON.stringify({user:a.user,isAuthenticated:!0})),console.log("Auth store: Saved to localStorage")):console.log("Auth store: No user in response"),a}catch(e){throw console.error("Auth store: OAuth login error:",e),e}finally{e({isLoading:!1})}},signup:async t=>{e({isLoading:!0});try{let o=await s.iJ.signup(t);o.user&&(e({user:o.user,isAuthenticated:!0}),localStorage.setItem("auth",JSON.stringify({user:o.user,isAuthenticated:!0})))}catch(e){throw e}finally{e({isLoading:!1})}},logout:async()=>{e({isLoading:!0});try{await s.iJ.logout(),e({user:null,isAuthenticated:!1}),localStorage.removeItem("auth")}catch(t){console.error("Logout error:",t),e({user:null,isAuthenticated:!1}),localStorage.removeItem("auth")}finally{e({isLoading:!1})}},getMe:async()=>{e({isLoading:!0});try{let t=await s.iJ.getMe();t.user?(e({user:t.user,isAuthenticated:!0}),localStorage.setItem("auth",JSON.stringify({user:t.user,isAuthenticated:!0}))):(e({user:null,isAuthenticated:!1}),localStorage.removeItem("auth"))}catch(o){var t;(null===(t=o.response)||void 0===t?void 0:t.status)===401||console.error("Auth check error:",o),e({user:null,isAuthenticated:!1}),localStorage.removeItem("auth")}finally{e({isLoading:!1})}},setUser:t=>{e({user:t,isAuthenticated:!!t}),t?localStorage.setItem("auth",JSON.stringify({user:t,isAuthenticated:!0})):localStorage.removeItem("auth")},reset:()=>{e({user:null,isAuthenticated:!1,isLoading:!1}),localStorage.removeItem("auth")},initialize:()=>{try{let t=localStorage.getItem("auth");if(t){let{user:o,isAuthenticated:r}=JSON.parse(t);e({user:o,isAuthenticated:r,isLoading:!1})}else e({isLoading:!1})}catch(t){console.error("Error loading auth state:",t),localStorage.removeItem("auth"),e({isLoading:!1})}}}))},6481:function(e,t,o){"use strict";var r,s,a,n;o.d(t,{O:function(){return s},Y:function(){return r}}),(a=r||(r={})).MALE="MALE",a.FEMALE="FEMALE",a.OTHER="OTHER",a.PREFER_NOT_TO_SAY="PREFER_NOT_TO_SAY",(n=s||(s={})).FACEBOOK="FACEBOOK",n.GOOGLE="GOOGLE"}},function(e){e.O(0,[42,64,580,971,117,744],function(){return e(e.s=5262)}),_N_E=e.O()}]);